---
title: "「箱入り娘」"
---

## なにこれ

パズル「箱入り娘」の各ピースがランダムに配置されます。

- 実行環境
  - <https://github.com/ushibutatory/game-hakoirimusume-pages>

## 使用ライブラリ

※アーキテクチャに関するもののみ

- UniTask
  - 非同期処理
- R3
  - Rx ライブラリ
- MessagePipe
  - Pub/Sub パターンの実装
  - 主に以下の用途で使用しています。
    - レイヤー間の通信、特に「メソッドの戻り値（＝実行結果）」に該当する処理。
    - 特にプレゼンテーション層における、オブジェクト間の通信。

## アーキテクチャ

MVVM パターンでやってみました。

```mermaid

```

### Model

- モデル操作
  - CQRS パターンをやってみようと思い、以下 2 種類のインタフェースを定義しました。
    - **Command** インタフェース
      - モデルの更新を提供します。
      - 例）
        - `IPieceCommand` ... ピース操作を提供するインタフェース
    - **Query** インタフェース
      - モデルの参照を提供します。
      - 例）
        - `IStageProvider` ... ステージ一覧を提供するインタフェース
- **Service**
- **DomainMessage**
  - モデルの更新結果などを表します。

### View

UI 単位で作成しました。
例えば以下のようなものです。

- `HeaderView`、`FooterView`
  - メニュー UI などの機能
- `GridCellView`
  - マス目ひとつ分のビュー。
- `GridView`
  - ステージ情報をもとにグリッドセルを配置するビュー。
- `PieceView`
  - 移動可能なピース 1 個分のビュー。

### ViewModel

### シーケンス例

#### ステージ選択

```mermaid

```

#### ピース移動

```mermaid

```

## 詳細

## 所感

モデル層に対して CQRS パターンを試してみましたが、複雑さが増加した割りに設計・実装上の旨味をほとんど感じませんでした。
